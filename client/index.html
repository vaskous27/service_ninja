<html ng-app="serviceninja">
<head>
  <title>Service Ninjas</title>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css">
   <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.2.min.js"></script>
   <script src="//cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/js/materialize.min.js"></script>
  <script type="text/javascript" src="js/materialize.min.js"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="/stylesdashboard.css" rel="stylesheet">
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular.min.js"></script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular-route.min.js"></script>
  <script>

      $(document).ready(function() {
          $('select').material_select();
          });

  	  var serviceninja = angular.module('serviceninja', ['ngRoute']);

      serviceninja.config(function ($routeProvider) {
          $routeProvider
            .when('/',{
                templateUrl: 'partials/front.html',
                controller: 'HomeController'
            })  
            .when('/login', {
                templateUrl: 'partials/login.html'
            })
            .when('/signup', {
                templateUrl: 'partials/signup.html'
            })
            .when('/dashboard/:id', {
                templateUrl: 'partials/dashboard.html'
            })            
             .when('/profile/:id', {
                templateUrl: 'partials/profileView.html'
            })
             .when('/form', {
                templateUrl: 'partials/profileForm.html'
            })
            .when('/message', {
                templateUrl: 'partials/message.html'
            })                        
            .otherwise({
              redirectTo: '/'
            });
       });

      serviceninja.controller('FrontController', function($scope){
      
      });

       serviceninja.factory('companyFactory', function($http, $location) {
          var factory = {};
          var user = {};
          var users = [];
          var editedUser = {};

            factory.create = function(new_user,callback) {
             console.log(new_user)
            $http.post('/users/new', new_user).success(function(res) {
              user = res;
              console.log(res)
              callback(res)
            })
          }

           factory.index = function(callback) {
              $http.get('/users').success(function(output) {
                users = output;
                callback(users);
              })
          }

          factory.getUser = function(id, callback) {
            console.log(id, "trying to get a company")
            $http.get('/users/' + id).success(function(data) {
              console.log(id, "came back from server with a company")
              user = data;
              callback(user);
            })
      }

          return factory;
      }) 


       serviceninja.controller('companyFormController', function($scope, $location, companyFactory){

         $scope.users = [];
         $scope.user = {};
         $scope.new_user = {};

         $scope.addUser = function() {
          companyFactory.create($scope.new_user, function(data) {
               $location.path('/profile/' + data._id);
            $scope.new_user = {};
          }) 
         };
       })

       serviceninja.controller('companyViewController', function($scope, $location, $routeParams, companyFactory){
           $scope.users = [];
           $scope.user = {};
           $scope.new_user = {};
           $scope.currentUser = {};
           var id = $routeParams.id;

           companyFactory.index(function(data) {
            $scope.users = data;
          })

           companyFactory.getUser(id, function(data) {
            console.log(data)
              $scope.currentUser = data; 
          })

         })

         serviceninja.controller('companyEditController', function($scope, $location, companyFactory, $routeParams){

             $scope.currentUser = {};
             $scope.user = {};
             var id = $routeParams.id;

            companyFactory.getUser(id, function(data) {
              console.log(data)
              $scope.currentUser = data; 
            })

         })

  </script>
</head>
<body>          
      <div ng-view="">
      </div>
</body>
</html>
